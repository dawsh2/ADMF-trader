<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-05-08 Thu 21:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="author" content="Dawson Shay" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org01bbf7d">1. Core</a>
<ul>
<li><a href="#org95c6527">1.1. Events</a></li>
</ul>
</li>
<li><a href="#org72b2fda">2. Data</a></li>
<li><a href="#org8a7053e">3. Strategy</a></li>
<li><a href="#orgbb85d27">4. Risk</a></li>
<li><a href="#org69dc619">5. Execution</a></li>
<li><a href="#org0fdef36">6. Analytics</a></li>
<li><a href="#org3f5ff90">7. Problems and Improvements</a></li>
</ul>
</div>
</div>
<p>
This system is an event driven backtesting system, managed in a configuration forward manner (i.e, the main entry point serves to load and execute the config to keep things tidy) divided into the following modules and responsiblities:
</p>

<p>
Note we also try and make use of the factory and registry pattern, I think, and make use of abstract base classes.
</p>
<div id="outline-container-org01bbf7d" class="outline-2">
<h2 id="org01bbf7d"><span class="section-number-2">1.</span> Core</h2>
<div class="outline-text-2" id="text-1">
<p>
Handles core system functionality, e.g bootstrap, dependency injection, errors, exceptions and loggging, config and event system. A central trade repository.
</p>

<p>
Maybe more I don't realize.
</p>
</div>
<div id="outline-container-org95c6527" class="outline-3">
<h3 id="org95c6527"><span class="section-number-3">1.1.</span> Events</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Event bus with pub/sub architecture and multiple event types (BAR, SIGNAL, ORDER, FILL, PORTFOLIO<sub>UPDATE</sub>, BACKTEST<sub>END</sub>, etc)
</p>
</div>
</div>
</div>
<div id="outline-container-org72b2fda" class="outline-2">
<h2 id="org72b2fda"><span class="section-number-2">2.</span> Data</h2>
<div class="outline-text-2" id="text-2">
<p>
Module for data handlers; loading historical data, handling train/test splits, handling live data.
</p>

<p>
Utilities for handling time stamps, time zones, etc. Transformers (normalizer, resampler).
</p>

<p>
Packages raw data and publishes/emits BAR event objects.
</p>
</div>
</div>
<div id="outline-container-org8a7053e" class="outline-2">
<h2 id="org8a7053e"><span class="section-number-2">3.</span> Strategy</h2>
<div class="outline-text-2" id="text-3">
<p>
Module for converting bar data into signals. Includes component based strategy building blocks (component ABC, indicators, features, rules, then finally strategies). Strategies may act as wrappers around other strategies as well, for things like regime filtering, signal processing, etc. Includes optimization module.
</p>

<p>
Strategies are composed of rules, rules of features, features of indicators, until we get to components. All these inherit from the Component ABC, I believe is best. Components build into strategies in other words.
</p>

<p>
Strategies can have any number of rules or even substrategies as part of them.
</p>

<p>
Contains directory with implementations, which are discovered automatically. We've written a lot in docs/ about how the optimization module should look and it's important we get this right. 
</p>

<p>
Consumes BAR event objects and publishes SIGNAL event objects.
</p>
</div>
</div>
<div id="outline-container-orgbb85d27" class="outline-2">
<h2 id="orgbb85d27"><span class="section-number-2">4.</span> Risk</h2>
<div class="outline-text-2" id="text-4">
<p>
Module for converting SIGNAL event objects into ORDER event objects. Includes sub modules/classes portfolio.py, position.py, PositionManager.
</p>

<p>
Risk managers are responsible for assessing current portfolio state and deciding to take a trade or not, as well as the position size. They should also include support for more advanced features
</p>

<p>
As mentioned below this module, for simplicity sake, should be easily configured to function as a passthrough, so I can focus on strategy development and trade validation without getting tangled up with this.
</p>

<p>
Consumes SIGNAL event objects and publishes ORDER event objects. Important to not duplicate ORDER event objects as they're passed off to the exeuction module.
</p>
</div>
</div>
<div id="outline-container-org69dc619" class="outline-2">
<h2 id="org69dc619"><span class="section-number-2">5.</span> Execution</h2>
<div class="outline-text-2" id="text-5">
<p>
Module for handling order execution. Include submodules broker (simulated for backtewsting and modeling slippage, commission, etc and real). Simulated broker can be plugged up to synthetic data generator for complete synthetic market experience. Also includes order manager module for creating and handling orders.
</p>

<p>
Inlcudes a backtest module for setting up the backtest environment. Our current version seems to include a specific optimization<sub>backtest.py</sub> module for setting up backtests that utilize optimization, and a backtest container is used somewhere for clean seperation of backtests state (seems this ended up in our src/core module somehow).
</p>


<p>
Noting here that our system handles the optimization process presumably by running each unique parameter configuration as a seperate backtest. 
</p>

<p>
Consumes ORDER event objects and publishes FILL and PORTFOLIO<sub>UPDATE</sub> objects. Perhaps the latter is redundant?
</p>
</div>
</div>
<div id="outline-container-org0fdef36" class="outline-2">
<h2 id="org0fdef36"><span class="section-number-2">6.</span> Analytics</h2>
<div class="outline-text-2" id="text-6">
<p>
Module for performance and reporting. All metrics and results math should be using this code. Pretty stragihtforward but extremely important! Will utlimately display graphics and a dashboard as well.
</p>
</div>
</div>
<div id="outline-container-org3f5ff90" class="outline-2">
<h2 id="org3f5ff90"><span class="section-number-2">7.</span> Problems and Improvements</h2>
<div class="outline-text-2" id="text-7">
<p>
Trouble getting simple backtest accomplished with all the moving parts. To accomplish this I wanted simple 'passthrough' risk and position managers that simply longed/shorted according the signal with fixed size, but even that has been too complex to introduce for some reason. e.g, if current signal is -1 and we're short, and signal
switchs from -1 to 1, we should buy to close, then buy to open a long. This behavior should be consistent or maybe defined within the risk manager or position manager we're using. 
</p>

<p>
Another issue, in my opinion signals should be sustained after events like a crossover until they revert and crossover oppositely (e.g, bullish to bearish crossover). But this can lead to difficulty in tracking signal duplication. 
</p>

<p>
Duplicate events, no single source of truth for equity curve / trade PnL. Forgetting to close trades before backtest ends.
Config option to close trades at end of day.
</p>

<p>
In general a more robust development process that consistently test and validates results externally using synthetic results and/or contried rules to ensure things are behaving as expected should be used. Doing full on test driven development is too complex right now as the process is too amorphous. 
</p>

<p>
Also need consistent, elegant design and such throughout. A typical entry point should look like:
</p>

<p>
python main.py &#x2013;config config/regime<sub>filter</sub><sub>ensemble.yaml</sub>
</p>

<p>
There are also some wrappers and garbage stuff like fixed<sub>xyz.py</sub> that should not exist in a quality codebase.
</p>


<p>
Overall it's really not complicated but my code keeps spaghetti'ing out. What I'd liek you to do is to determine if a rewrite is necassary or if we can save ourselves. 
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Dawson Shay</p>
<p class="date">Created: 2025-05-08 Thu 21:30</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
