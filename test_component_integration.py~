# test_component_integration.py
import logging
from src.core.di.container import Container
from src.core.events.event_bus import EventBus
from src.core.events.event_manager import EventManager
from src.data.sources.csv_handler import CSVDataSource
from src.data.historical_data_handler import HistoricalDataHandler
from src.risk.portfolio.portfolio import PortfolioManager
from src.core.events.event_types import EventType, Event

# Set up logging
logging.basicConfig(level=logging.INFO, 
                    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

def test_di_system():
    # Create DI container
    container = Container()
    
    # Register components
    container.register('event_bus', EventBus)
    
    # Register components with dependencies
    container.register('event_manager', EventManager, 
                      dependencies={'event_bus': 'event_bus'})
    
    container.register('csv_source', CSVDataSource,
                      dependencies={})
    
    container.register('data_handler', HistoricalDataHandler, 
                      dependencies={'data_source': 'csv_source'})
    
    container.register('portfolio', PortfolioManager, 
                      dependencies={'event_bus': 'event_bus'})
    
    # Get components
    event_bus = container.get('event_bus')
    data_handler = container.get('data_handler')
    portfolio = container.get('portfolio')
    
    # Verify components were created
    logger.info(f"Created components:")
    logger.info(f"- EventBus: {event_bus}")
    logger.info(f"- DataHandler: {data_handler}")
    logger.info(f"- Portfolio: {portfolio}")
    
    return all([event_bus, data_handler, portfolio])

if __name__ == "__main__":
    success = test_di_system()
    logger.info(f"Integration test {'passed' if success else 'failed'}")
